<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>発注書登録テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>発注書登録テスト</h1>
    
    <div class="test-section">
        <h2>1. テストデータで登録</h2>
        <button class="btn btn-success" onclick="testRegistration()">テスト発注書を登録</button>
        <button class="btn btn-danger" onclick="clearStorage()">LocalStorageをクリア</button>
    </div>
    
    <div class="test-section">
        <h2>2. 保存された発注書を確認</h2>
        <button class="btn" onclick="showStoredOrders()">保存された発注書を表示</button>
        <div id="storedOrders" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>3. 発注書管理ページ</h2>
        <button class="btn" onclick="openManagement()">発注書管理ページを開く</button>
    </div>
    
    <div class="test-section">
        <h2>4. コンソールログ</h2>
        <div id="consoleLog" class="log">コンソールログがここに表示されます...</div>
    </div>

    <script>
        // コンソールログを表示
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('consoleLog');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logDiv.textContent += args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logDiv.textContent += 'ERROR: ' + args.join(' ') + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        // テスト用の発注書データを登録
        function testRegistration() {
            console.log('=== テスト発注書登録開始 ===');
            
            const testOrderData = {
                companyName: '株式会社諸鹿彩色',
                companyCode: 'T6060001025935',
                companyAddress: '〒321-0111 栃木県宇都宮市川田町1048-5',
                companyPhone: 'TEL: 028-688-8618  FAX: 028-688-0668',
                companyEmail: 'info@moroga.info',
                orderDate: '2024-01-15',
                staffMember: '諸鹿大介',
                supplierName: 'テスト発注先株式会社',
                supplierAddress: '東京都渋谷区テスト1-2-3',
                contactPerson: '田中太郎',
                'itemProjectName[]': ['テスト工事'],
                'itemName[]': ['テスト商品'],
                'itemQuantity[]': [1],
                'itemUnit[]': ['個'],
                'itemPrice[]': [10000],
                'itemSubtotal[]': [10000],
                completionMonth: '2024-02',
                paymentTerms: '工事完了月の翌月末払い',
                remarks: 'テスト用発注書です',
                subtotal: 10000,
                tax: 1000,
                total: 11000
            };
            
            try {
                // 発注書データを保存
                const orders = loadOrdersFromStorage();
                const orderId = 'TEST-' + Date.now();
                const orderData = {
                    id: orderId,
                    ...testOrderData,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                orders.push(orderData);
                localStorage.setItem('purchaseOrders', JSON.stringify(orders));
                
                console.log('テスト発注書を保存しました:', orderData);
                alert('テスト発注書を登録しました！');
                
            } catch (error) {
                console.error('テスト発注書登録エラー:', error);
                alert('テスト発注書の登録に失敗しました: ' + error.message);
            }
        }
        
        // LocalStorageをクリア
        function clearStorage() {
            localStorage.removeItem('purchaseOrders');
            console.log('LocalStorageをクリアしました');
            alert('LocalStorageをクリアしました');
        }
        
        // 保存された発注書を表示
        function showStoredOrders() {
            const orders = loadOrdersFromStorage();
            const storedOrdersDiv = document.getElementById('storedOrders');
            
            if (orders.length === 0) {
                storedOrdersDiv.textContent = '保存された発注書はありません';
                return;
            }
            
            let html = `保存された発注書数: ${orders.length}\n\n`;
            orders.forEach((order, index) => {
                html += `--- 発注書 ${index + 1} ---\n`;
                html += `ID: ${order.id}\n`;
                html += `発注先: ${order.supplierName || '未設定'}\n`;
                html += `担当: ${order.staffMember || '未設定'}\n`;
                html += `合計金額: ¥${order.total || '0'}\n`;
                html += `作成日: ${order.createdAt || '未設定'}\n\n`;
            });
            
            storedOrdersDiv.textContent = html;
        }
        
        // 発注書管理ページを開く
        function openManagement() {
            window.open('management.html', '_blank');
        }
        
        // 発注書データを読み込み
        function loadOrdersFromStorage() {
            try {
                const saved = localStorage.getItem('purchaseOrders');
                return saved ? JSON.parse(saved) : [];
            } catch (error) {
                console.error('発注書データの読み込みエラー:', error);
                return [];
            }
        }
        
        // ページ読み込み時に保存された発注書を表示
        window.addEventListener('load', () => {
            showStoredOrders();
        });
    </script>
</body>
</html>



